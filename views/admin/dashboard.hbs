{{!-- üéØ DASHBOARD EJECUTIVO PROFESIONAL - LAYOUT OPTIMIZADO --}}

{{!-- 1. HEADER CON TOGGLE DE MODO --}}
<div class="row mb-2">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center bg-white p-3 rounded shadow-sm">
      <div>
        <h4 class="mb-0 text-dark">
          {{#if modoComparativo}}
            An√°lisis Comparativo
          {{else}}
            Panel de Control Ejecutivo
          {{/if}}
        </h4>
        <small class="text-muted">
          {{#if modoComparativo}}
            {{periodoA.texto}} vs {{periodoB.texto}}
          {{else}}
            {{periodo.periodoTexto}} ‚Ä¢ {{metricas.totalDocumentos}} docs ‚Ä¢ Retenciones: ${{finanzas.totalRetenido}}
          {{/if}}
        </small>
      </div>
      <div class="text-end">
        {{!-- TOGGLE DE MODO --}}
        <div class="btn-group me-3" role="group">
          <button type="button" class="btn {{#unless modoComparativo}}btn-primary{{else}}btn-outline-primary{{/unless}} btn-sm" 
                  onclick="cambiarModo('normal')">
            <i class="fas fa-chart-bar"></i> Normal
          </button>
          <button type="button" class="btn {{#if modoComparativo}}btn-primary{{else}}btn-outline-primary{{/if}} btn-sm" 
                  onclick="cambiarModo('comparativo')">
            <i class="fas fa-exchange-alt"></i> Comparar
          </button>
        </div>
        <span class="badge bg-primary px-3 py-2">
          {{#if modoComparativo}}
            An√°lisis activo
          {{else}}
            {{metricas.totalDocumentos}} documentos
          {{/if}}
        </span>
      </div>
    </div>
  </div>
</div>

{{!-- 2. FILTROS DIN√ÅMICOS SEG√öN MODO --}}
<div class="row mb-3">
  {{!-- FILTROS NORMALES O COMPARATIVOS (8 columnas) --}}
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm">
      <div class="card-body py-2">
        {{#if modoComparativo}}
          {{!-- FILTROS COMPARATIVOS --}}
          <form id="comparativoForm" class="row align-items-center">
            <div class="col-md-6">
              <label class="form-label text-primary fw-bold mb-1">PER√çODO A (Base)</label>
              <div class="d-flex mb-2">
                <select class="form-select form-select-sm me-1" id="rangoA" name="rangoA">
                  <option value="mes" {{#if (eq filtros.rangoA 'mes')}}selected{{/if}}>Este mes</option>
                  <option value="mes_anterior" {{#if (eq filtros.rangoA 'mes_anterior')}}selected{{/if}}>Mes anterior</option>
                  <option value="semana" {{#if (eq filtros.rangoA 'semana')}}selected{{/if}}>Esta semana</option>
                  <option value="semana_anterior" {{#if (eq filtros.rangoA 'semana_anterior')}}selected{{/if}}>Semana anterior</option>
                  <option value="trimestre" {{#if (eq filtros.rangoA 'trimestre')}}selected{{/if}}>Este trimestre</option>
                  <option value="trimestre_anterior" {{#if (eq filtros.rangoA 'trimestre_anterior')}}selected{{/if}}>Trimestre anterior</option>
                  <option value="personalizado" {{#if (eq filtros.rangoA 'personalizado')}}selected{{/if}}>Personalizado</option>
                </select>
              </div>
              <div class="d-flex">
                <input type="date" class="form-control form-control-sm me-1" id="fechaInicioA" name="fechaInicioA" value="{{filtros.fechaInicioA}}">
                <input type="date" class="form-control form-control-sm" id="fechaFinA" name="fechaFinA" value="{{filtros.fechaFinA}}">
              </div>
              <small class="text-muted">{{periodoA.totalDocumentos}} documentos</small>
            </div>
            <div class="col-md-6">
              <label class="form-label text-info fw-bold mb-1">PER√çODO B (Comparar)</label>
              <div class="d-flex mb-2">
                <select class="form-select form-select-sm me-1" id="rangoB" name="rangoB">
                  <option value="mes_anterior" {{#if (eq filtros.rangoB 'mes_anterior')}}selected{{/if}}>Mes anterior</option>
                  <option value="mes" {{#if (eq filtros.rangoB 'mes')}}selected{{/if}}>Este mes</option>
                  <option value="semana_anterior" {{#if (eq filtros.rangoB 'semana_anterior')}}selected{{/if}}>Semana anterior</option>
                  <option value="semana" {{#if (eq filtros.rangoB 'semana')}}selected{{/if}}>Esta semana</option>
                  <option value="trimestre_anterior" {{#if (eq filtros.rangoB 'trimestre_anterior')}}selected{{/if}}>Trimestre anterior</option>
                  <option value="trimestre" {{#if (eq filtros.rangoB 'trimestre')}}selected{{/if}}>Este trimestre</option>
                  <option value="personalizado" {{#if (eq filtros.rangoB 'personalizado')}}selected{{/if}}>Personalizado</option>
                </select>
                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="intercambiarPeriodos()" title="Intercambiar per√≠odos">
                  <i class="fas fa-exchange-alt"></i>
                </button>
              </div>
              <div class="d-flex">
                <input type="date" class="form-control form-control-sm me-1" id="fechaInicioB" name="fechaInicioB" value="{{filtros.fechaInicioB}}">
                <input type="date" class="form-control form-control-sm" id="fechaFinB" name="fechaFinB" value="{{filtros.fechaFinB}}">
              </div>
              <small class="text-muted">{{periodoB.totalDocumentos}} documentos</small>
            </div>
            <div class="col-12 mt-2">
              <button type="submit" class="btn btn-primary btn-sm">
                <i class="fas fa-chart-line"></i> Actualizar Comparaci√≥n
              </button>
            </div>
          </form>
        {{else}}
          {{!-- FILTROS NORMALES --}}
          <form id="periodoForm" class="row align-items-center">
            <div class="col-md-4">
              <div class="d-flex">
                <input type="date" class="form-control form-control-sm me-1" id="fechaInicio" name="fechaInicio" value="{{periodo.fechaInicio}}">
                <input type="date" class="form-control form-control-sm" id="fechaFin" name="fechaFin" value="{{periodo.fechaFin}}">
              </div>
            </div>
            <div class="col-md-8">
              <div class="btn-group btn-group-sm w-100" role="group">
                <button type="button" class="btn btn-outline-primary" data-periodo="hoy">Hoy</button>
                <button type="button" class="btn btn-outline-primary" data-periodo="semana">Semana</button>
                <button type="button" class="btn btn-outline-primary" data-periodo="mes">Mes</button>
                <button type="button" class="btn btn-outline-primary" data-periodo="a√±o">A√±o</button>
              </div>
            </div>
            <input type="hidden" id="tipoPeriodo" name="tipoPeriodo" value="{{periodo.rango}}">
          </form>
        {{/if}}
      </div>
    </div>
  </div>
  
  {{!-- ALERTAS COMPACTAS (4 columnas) --}}
  <div class="col-lg-4">
    {{#if alertasCriticas}}
    <div class="card border-0 shadow-sm border-left-warning">
      <div class="card-body py-2">
        <div class="d-flex align-items-center">
          <i class="fas fa-exclamation-triangle text-warning me-2"></i>
          <div class="flex-grow-1">
            <small class="text-warning font-weight-bold">ATENCI√ìN REQUERIDA</small>
            <div class="d-flex justify-content-between">
              <small>{{alertasCriticas.length}} alertas</small>
              <small>{{metricas.documentosUrgentes}} urgentes</small>
            </div>
          </div>
          <a href="#alertas-section" class="btn btn-warning btn-sm">Ver</a>
        </div>
      </div>
    </div>
    {{else}}
    <div class="card border-0 shadow-sm border-left-success">
      <div class="card-body py-2">
        <div class="d-flex align-items-center">
          <i class="fas fa-check-circle text-success me-2"></i>
          <div class="flex-grow-1">
            <small class="text-success font-weight-bold">TODO EN ORDEN</small>
            <div><small class="text-muted">Sin problemas detectados</small></div>
          </div>
        </div>
      </div>
    </div>
    {{/if}}
  </div>
</div>

{{#if modoComparativo}}
{{!-- CONTENIDO COMPARATIVO --}}

{{!-- 3. M√âTRICAS COMPARATIVAS --}}
<div class="row mb-4">
  <div class="col-12">
    <div class="card border-0 shadow">
      <div class="card-header bg-gradient-primary text-white">
        <h5 class="mb-0">
          <i class="fas fa-chart-line me-2"></i>
          Comparaci√≥n: {{periodoA.texto}} vs {{periodoB.texto}}
        </h5>
      </div>
      <div class="card-body">
        <div class="row">
          {{#each analisis.comparaciones}}
          <div class="col-lg-6 col-xl-4 mb-3">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex align-items-center mb-2">
                  <i class="{{icono}} fa-lg text-{{color}} me-2"></i>
                  <h6 class="mb-0 text-uppercase">{{nombre}}</h6>
                </div>
                
                <div class="row">
                  {{!-- Per√≠odo A --}}
                  <div class="col-6">
                    <div class="text-center p-2 bg-primary bg-opacity-10 rounded">
                      <small class="text-primary fw-bold">PER√çODO A</small>
                      <div class="h5 mb-0 text-primary">{{valorAFormateado}}</div>
                    </div>
                  </div>
                  
                  {{!-- Per√≠odo B --}}
                  <div class="col-6">
                    <div class="text-center p-2 bg-info bg-opacity-10 rounded">
                      <small class="text-info fw-bold">PER√çODO B</small>
                      <div class="h5 mb-0 text-info">{{valorBFormateado}}</div>
                    </div>
                  </div>
                </div>
                
                {{!-- Diferencia y porcentaje --}}
                <div class="text-center mt-2">
                  <div class="badge bg-{{color}} fs-6">
                    {{#if (eq direccion 'up')}}
                      <i class="fas fa-arrow-up"></i> {{diferenciaFormateada}}
                    {{else if (eq direccion 'down')}}
                      <i class="fas fa-arrow-down"></i> {{diferenciaFormateada}}
                    {{else}}
                      <i class="fas fa-minus"></i> Sin cambio
                    {{/if}}
                  </div>
                  {{#unless (eq direccion 'equal')}}
                  <div class="small text-{{color}} mt-1">{{porcentajeFormateado}}</div>
                  {{/unless}}
                </div>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </div>
  </div>
</div>

{{!-- 4. INSIGHTS AUTOM√ÅTICOS --}}
<div class="row mb-4">
  <div class="col-lg-8">
    <div class="card border-0 shadow">
      <div class="card-header bg-light">
        <h6 class="mb-0">
          <i class="fas fa-brain text-primary me-2"></i>
          Insights Autom√°ticos
        </h6>
      </div>
      <div class="card-body">
        {{#if analisis.insights.cambiosSignificativos}}
        <div class="mb-3">
          <h6 class="text-primary">üìà Cambios M√°s Significativos:</h6>
          <ul class="list-unstyled">
            {{#each analisis.insights.cambiosSignificativos}}
            <li class="mb-1">
              <span class="badge bg-{{color}} me-2">{{#if (gt porcentaje 0)}}+{{/if}}{{porcentaje}}%</span>
              <strong>{{nombre}}:</strong> 
              {{#if (eq formato 'moneda')}}
                ${{diferencia}}
              {{else}}
                {{diferencia}}
              {{/if}}
              {{#if (eq direccion 'up')}}(mejora){{else}}(disminuci√≥n){{/if}}
            </li>
            {{/each}}
          </ul>
        </div>
        {{/if}}
        
        {{#if analisis.insights.recomendaciones}}
        <div>
          <h6 class="text-success">üéØ Recomendaciones:</h6>
          <ul class="list-unstyled">
            {{#each analisis.insights.recomendaciones}}
            <li class="mb-1">
              <i class="fas fa-lightbulb text-warning me-2"></i>
              {{this}}
            </li>
            {{/each}}
          </ul>
        </div>
        {{/if}}
      </div>
    </div>
  </div>
  
  <div class="col-lg-4">
    <div class="card border-0 shadow">
      <div class="card-header bg-light">
        <h6 class="mb-0">
          <i class="fas fa-chart-pie text-info me-2"></i>
          Resumen Ejecutivo
        </h6>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col-6">
            <div class="border-end">
              <div class="h4 text-success mb-0">{{analisis.insights.mejoras.length}}</div>
              <small class="text-muted">Mejoras</small>
            </div>
          </div>
          <div class="col-6">
            <div class="h4 text-danger mb-0">{{analisis.insights.empeoramientos.length}}</div>
            <small class="text-muted">Disminuciones</small>
          </div>
        </div>
        
        <hr class="my-3">
        
        <div class="text-center">
          {{#if (gt analisis.insights.mejoras.length analisis.insights.empeoramientos.length)}}
            <div class="text-success">
              <i class="fas fa-thumbs-up fa-2x mb-2"></i>
              <div class="fw-bold">Tendencia Positiva</div>
              <small>M√°s mejoras que retrocesos</small>
            </div>
          {{else if (gt analisis.insights.empeoramientos.length analisis.insights.mejoras.length)}}
            <div class="text-warning">
              <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
              <div class="fw-bold">Requiere Atenci√≥n</div>
              <small>M√°s disminuciones que mejoras</small>
            </div>
          {{else}}
            <div class="text-info">
              <i class="fas fa-balance-scale fa-2x mb-2"></i>
              <div class="fw-bold">Estable</div>
              <small>Cambios equilibrados</small>
            </div>
          {{/if}}
        </div>
      </div>
    </div>
  </div>
</div>

{{else}}
{{!-- CONTENIDO NORMAL --}}

{{!-- 3. FILA 1: M√âTRICAS FINANCIERAS (ORDEN L√ìGICO) --}}
<div class="row mb-3">
  {{!-- 1. FACTURADO (Origen del flujo) --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-primary text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">FACTURADO</div>
            <div class="h4 mb-0">${{finanzas.facturacionPeriodo}}</div>
            <small class="text-white-75">Total a cobrar</small>
          </div>
          <i class="fas fa-file-invoice fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>

  {{!-- 2. COBRADO (Dinero recibido) --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-success text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">COBRADO</div>
            <div class="h4 mb-0">${{finanzas.ingresosPeriodo}}</div>
            <small class="text-white-75">Dinero recibido</small>
          </div>
          <i class="fas fa-dollar-sign fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>

  {{!-- 3. RETENIDO (CORREGIDO - dinero "cobrado" por retenciones) --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-info text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">RETENIDO</div>
            <div class="h4 mb-0">
              ${{finanzas.totalRetenido}}
            </div>
            <small class="text-white-75">Por retenciones</small>
            {{!-- DEBUG TEMPORAL: Mostrar valor raw --}}
            <div style="font-size: 8px; opacity: 0.7;">
              DEBUG: "{{finanzas.totalRetenido}}" ({{#if finanzas.totalRetenido}}SI{{else}}NO{{/if}})
            </div>
          </div>
          <i class="fas fa-receipt fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>

  {{!-- 4. PENDIENTE (Lo que falta por cobrar) --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-warning text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">PENDIENTE</div>
            <div class="h4 mb-0">${{finanzas.totalPendiente}}</div>
            <small class="text-white-75">Por cobrar</small>
          </div>
          <i class="fas fa-clock fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>
</div>

{{!-- 4. FILA 2: ESTADOS DE DOCUMENTOS (FLUJO DEL PROCESO) --}}
<div class="row mb-3">
  {{!-- 1. TOTAL DOCUMENTOS --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card border-0 shadow-sm border-left-primary h-100">
      <div class="card-body py-3">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="fas fa-file-alt fa-2x text-primary"></i>
          </div>
          <div>
            <div class="text-xs font-weight-bold text-primary text-uppercase">Total</div>
            <div class="h4 mb-0 font-weight-bold">{{metricas.totalDocumentos}}</div>
            <small class="text-muted">Documentos</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  {{!-- 2. EN PROCESO --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card border-0 shadow-sm border-left-warning h-100">
      <div class="card-body py-3">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="fas fa-cogs fa-2x text-warning"></i>
          </div>
          <div>
            <div class="text-xs font-weight-bold text-warning text-uppercase">En Proceso</div>
            <div class="h4 mb-0 font-weight-bold">{{metricas.enProceso}}</div>
            <small class="text-muted">Procesando</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  {{!-- 3. LISTOS PARA ENTREGA --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card border-0 shadow-sm border-left-success h-100">
      <div class="card-body py-3">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="fas fa-check-circle fa-2x text-success"></i>
          </div>
          <div>
            <div class="text-xs font-weight-bold text-success text-uppercase">Listos</div>
            <div class="h4 mb-0 font-weight-bold">{{metricas.listoParaEntrega}}</div>
            <small class="text-muted">Para entrega</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  {{!-- 4. ENTREGADOS (MOVIDO AQU√ç DESDE FILA 3) --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card border-0 shadow-sm border-left-dark h-100">
      <div class="card-body py-3">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="fas fa-handshake fa-2x text-dark"></i>
          </div>
          <div>
            <div class="text-xs font-weight-bold text-dark text-uppercase">Entregados</div>
            <div class="h4 mb-0 font-weight-bold">{{metricas.entregados}}</div>
            <small class="text-muted">Completados</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{{!-- 5. FILA 3: RENDIMIENTO Y ACTIVIDAD (SIN DUPLICACI√ìN) --}}
<div class="row mb-3">
  {{!-- 1. EFICIENCIA DE ENTREGA (√öNICA M√âTRICA DE EFICIENCIA) --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-secondary text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">EFICIENCIA DE ENTREGA</div>
            <div class="h4 mb-0">
              {{#if (and metricas.totalDocumentos (gt metricas.totalDocumentos 0))}}
                {{percentage metricas.entregados metricas.totalDocumentos}}
              {{else}}
                0%
              {{/if}}
            </div>
            <small class="text-white-75">{{metricas.entregados}} de {{metricas.totalDocumentos}}</small>
          </div>
          <i class="fas fa-chart-line fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>

  {{!-- 2. ENTREGADOS HOY --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-gradient-success text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">HOY ENTREGADOS</div>
            <div class="h4 mb-0">{{metricas.entregadosHoy}}</div>
            <small class="text-white-75">Documentos</small>
          </div>
          <i class="fas fa-calendar-check fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>

  {{!-- 3. HOY COBRADOS --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-gradient-primary text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">HOY COBRADOS</div>
            <div class="h4 mb-0">${{finanzas.ingresosHoy}}</div>
            <small class="text-white-75">{{finanzas.documentosCobradosHoy}} docs</small>
          </div>
          <i class="fas fa-coins fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>

  {{!-- 4. ESPACIO PARA FUTURA M√âTRICA --}}
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-light border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-muted small">DISPONIBLE</div>
            <div class="h4 mb-0 text-muted">---</div>
            <small class="text-muted">Pr√≥xima m√©trica</small>
          </div>
          <i class="fas fa-plus fa-2x text-muted"></i>
        </div>
      </div>
    </div>
  </div>
</div>

{{!-- VALIDACI√ìN MATEM√ÅTICA PROFESIONAL CON F√ìRMULA EXACTA --}}
<div class="row mb-3">
  <div class="col-12">
    <div class="alert alert-light border-left-success py-2">
      <small class="text-muted">
        <i class="fas fa-calculator text-success me-1"></i>
        <strong>F√≥rmula Financiera:</strong> 
        Facturado (${{finanzas.facturacionPeriodo}}) = Cobrado (${{finanzas.ingresosPeriodo}}) + Retenido (${{finanzas.totalRetenido}}) + Pendiente (${{finanzas.totalPendiente}})
        <span class="text-success ms-2"><i class="fas fa-check-circle"></i> Matem√°tica exacta verificada</span>
      </small>
    </div>
  </div>
</div>

{{!-- üö® ALERTAS CR√çTICAS DESTACADAS --}}
{{#if alertasCriticas}}
<div class="row mb-4">
  <div class="col-12">
    <div class="card border-left-danger shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0 text-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Situaciones que Requieren Atenci√≥n Inmediata
        </h6>
      </div>
      <div class="card-body">
        <div class="row">
          {{#each alertasCriticas}}
          <div class="col-md-6 col-xl-3 mb-3">
            <div class="alert alert-{{tipo}} border-left-{{tipo}} mb-0">
              <div class="d-flex align-items-center">
                <i class="{{icono}} fa-2x me-3"></i>
                <div>
                  <div class="font-weight-bold">{{titulo}}</div>
                  <small>{{descripcion}}</small>
                  <div class="mt-2">
                    <a href="{{accion}}" class="btn btn-{{tipo}} btn-sm">
                      <i class="fas fa-arrow-right me-1"></i>Gestionar
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </div>
  </div>
</div>
{{/if}}

{{!-- üîÑ ACTIVIDAD RECIENTE Y RENDIMIENTO DEL EQUIPO --}}
<div class="row mb-4">
  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">
          <i class="fas fa-credit-card text-primary me-2"></i>
          √öltimos Pagos Registrados
        </h6>
      </div>
      <div class="card-body">
        {{#if ultimosPagos}}
        <div class="table-responsive">
          <table class="table table-sm table-hover">
            <thead>
              <tr>
                <th>C√≥digo</th>
                <th>Cliente</th>
                <th>Valor</th>
                <th>M√©todo</th>
                <th>Fecha</th>
              </tr>
            </thead>
            <tbody>
              {{#each ultimosPagos}}
              <tr>
                <td>
                  <code class="text-primary">{{this.codigoBarras}}</code>
                </td>
                <td>
                  <div class="font-weight-bold">{{this.nombreCliente}}</div>
                  {{#if this.numeroFactura}}
                  <small class="text-muted">Fact: {{this.numeroFactura}}</small>
                  {{/if}}
                </td>
                <td>
                  <span class="text-success font-weight-bold">${{this.valorFactura}}</span>
                </td>
                <td>
                  <span class="badge bg-secondary">{{this.metodoPago}}</span>
                </td>
                <td>
                  <small class="text-muted">{{formatDateEcuador this.fechaPago}}</small>
                </td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
        <div class="text-center mt-3">
          <a href="/admin/reportes/financiero" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-chart-line me-1"></i>Ver Reporte Financiero
          </a>
        </div>
        {{else}}
        <div class="text-center text-muted py-4">
          <i class="fas fa-info-circle fa-2x mb-2"></i>
          <p class="mb-0">No hay pagos registrados en el per√≠odo seleccionado</p>
          <small class="text-muted">Los pagos aparecer√°n aqu√≠ cuando se registren</small>
        </div>
        {{/if}}
      </div>
    </div>
  </div>

  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">
          <i class="fas fa-users text-primary me-2"></i>
          Rendimiento del Equipo (7 d√≠as)
        </h6>
      </div>
      <div class="card-body">
        {{#if equipoRendimiento}}
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Matrizador</th>
                <th class="text-center">Procesados</th>
                <th class="text-center">Entregados</th>
                <th class="text-end">Cobrado</th>
              </tr>
            </thead>
            <tbody>
              {{#each equipoRendimiento}}
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="bg-primary text-white rounded-circle me-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; font-size: 12px;">
                      {{substring this.nombre 0 2}}
                    </div>
                    <span class="font-weight-bold">{{this.nombre}}</span>
                  </div>
                </td>
                <td class="text-center">
                  <span class="badge bg-primary">{{this.documentos_procesados}}</span>
                </td>
                <td class="text-center">
                  <span class="badge bg-success">{{this.documentos_entregados}}</span>
                </td>
                <td class="text-end">
                  <span class="font-weight-bold">${{this.dinero_cobrado}}</span>
                </td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
        <div class="text-center mt-3">
          <a href="/admin/reportes/matrizadores" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-users me-1"></i>Ver Reporte Completo
          </a>
        </div>
        {{else}}
        <div class="text-center text-muted py-4">
          <i class="fas fa-users fa-2x mb-2"></i>
          <p class="mb-0">No hay datos de rendimiento disponibles</p>
        </div>
        {{/if}}
      </div>
    </div>
  </div>
</div>

{{!-- üö® SECCI√ìN DE ALERTAS DETALLADAS --}}
{{#if alertasCriticas}}
<div id="alertas-section" class="row mb-4">
  <div class="col-12">
    <div class="card border-left-danger shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0 text-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Situaciones que Requieren Atenci√≥n Inmediata
        </h6>
      </div>
      <div class="card-body">
        <div class="row">
          {{#each alertasCriticas}}
          <div class="col-md-6 col-xl-3 mb-3">
            <div class="alert alert-{{tipo}} border-left-{{tipo}} mb-0">
              <div class="d-flex align-items-center">
                <i class="{{icono}} fa-2x me-3"></i>
                <div>
                  <div class="font-weight-bold">{{titulo}}</div>
                  <small>{{descripcion}}</small>
                  <div class="mt-2">
                    <a href="{{accion}}" class="btn btn-{{tipo}} btn-sm">
                      <i class="fas fa-arrow-right me-1"></i>Gestionar
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </div>
  </div>
</div>
{{/if}}

{{!-- üìã √öLTIMAS ENTREGAS Y DOCUMENTOS CR√çTICOS --}}
<div class="row mb-4">
  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">
          <i class="fas fa-handshake text-primary me-2"></i>
          √öltimas Entregas Realizadas
        </h6>
      </div>
      <div class="card-body">
        {{#if ultimasEntregas}}
        <div class="list-group list-group-flush">
          {{#each ultimasEntregas}}
          <div class="list-group-item border-0 px-0">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <div class="font-weight-bold">{{this.nombreCliente}}</div>
                <small class="text-muted">{{this.codigoBarras}} - {{this.tipoDocumento}}</small>
                {{#if this.matrizador}}
                <div><small class="text-info">Matrizador: {{this.matrizador.nombre}}</small></div>
                {{/if}}
              </div>
              <div class="text-end">
                <span class="badge bg-success">Entregado</span>
                <div><small class="text-muted">{{formatDate this.fechaEntrega}}</small></div>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
        <div class="text-center mt-3">
          <a href="/admin/documentos/listado?estado=entregado" class="btn btn-outline-success btn-sm">
            <i class="fas fa-list me-1"></i>Ver Todos los Entregados
          </a>
        </div>
        {{else}}
        <div class="text-center text-muted py-4">
          <i class="fas fa-handshake fa-2x mb-2"></i>
          <p class="mb-0">No hay entregas recientes</p>
        </div>
        {{/if}}
      </div>
    </div>
  </div>

  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">
          <i class="fas fa-exclamation-triangle text-warning me-2"></i>
          Documentos que Requieren Atenci√≥n
        </h6>
      </div>
      <div class="card-body">
        {{#if documentosUrgentes}}
        <div class="list-group list-group-flush">
          {{#each documentosUrgentes}}
          <div class="list-group-item border-0 px-0">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <div class="font-weight-bold">{{this.codigoBarras}}</div>
                <small class="text-muted">{{this.nombreCliente}}</small>
                {{#if this.matrizador}}
                <div><small class="text-info">Asignado: {{this.matrizador.nombre}}</small></div>
                {{/if}}
              </div>
              <div class="text-end">
                <span class="badge bg-warning">Pendiente</span>
                <div><small class="text-muted">{{daysAgo this.createdAt}} d√≠as</small></div>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
        <div class="text-center mt-3">
          <a href="/admin/reportes/pendientes" class="btn btn-outline-warning btn-sm">
            <i class="fas fa-exclamation-triangle me-1"></i>Ver Reporte de Pendientes
          </a>
        </div>
        {{else}}
        <div class="text-center text-muted py-4">
          <i class="fas fa-check-circle fa-2x mb-2 text-success"></i>
          <p class="mb-0">Todos los documentos est√°n al d√≠a</p>
        </div>
        {{/if}}
      </div>
    </div>
  </div>
</div>

{{!-- üéØ ACCESOS R√ÅPIDOS EJECUTIVOS --}}
<div class="row mb-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">
          <i class="fas fa-bolt text-primary me-2"></i>
          Accesos R√°pidos Administrativos
        </h6>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col-md-3 mb-3">
            <a href="/admin/reportes/pendientes" class="btn btn-lg btn-outline-danger w-100 h-100 py-4">
              <i class="fas fa-exclamation-triangle fa-2x mb-3"></i><br>
              <strong>Pagos Atrasados</strong><br>
              <small>Gesti√≥n de cobranza</small>
            </a>
          </div>
          <div class="col-md-3 mb-3">
            <a href="/admin/reportes/financiero" class="btn btn-lg btn-outline-success w-100 h-100 py-4">
              <i class="fas fa-chart-line fa-2x mb-3"></i><br>
              <strong>Reporte Financiero</strong><br>
              <small>An√°lisis de ingresos</small>
            </a>
          </div>
          <div class="col-md-3 mb-3">
            <a href="/admin/documentos/listado" class="btn btn-lg btn-outline-primary w-100 h-100 py-4">
              <i class="fas fa-search fa-2x mb-3"></i><br>
              <strong>Buscar Documentos</strong><br>
              <small>Consulta avanzada</small>
            </a>
          </div>
          <div class="col-md-3 mb-3">
            <a href="/admin/auditoria-eliminaciones" class="btn btn-lg btn-outline-info w-100 h-100 py-4">
              <i class="fas fa-shield-alt fa-2x mb-3"></i><br>
              <strong>Auditor√≠a</strong><br>
              <small>Registros de seguridad</small>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{{/if}}

{{!-- üîß JAVASCRIPT PARA FUNCIONALIDAD INTERACTIVA OPTIMIZADA --}}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // ============ FUNCIONALIDAD COMPARATIVA ============
  
  {{#if modoComparativo}}
  // Modo comparativo activo
  const comparativoForm = document.getElementById('comparativoForm');
  
  if (comparativoForm) {
    comparativoForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const params = new URLSearchParams();
      
      params.append('modo', 'comparativo');
      params.append('rangoA', formData.get('rangoA'));
      params.append('rangoB', formData.get('rangoB'));
      params.append('fechaInicioA', formData.get('fechaInicioA'));
      params.append('fechaFinA', formData.get('fechaFinA'));
      params.append('fechaInicioB', formData.get('fechaInicioB'));
      params.append('fechaFinB', formData.get('fechaFinB'));
      
      window.location.href = '/admin?' + params.toString();
    });
    
    // Auto-actualizar fechas cuando cambia el rango
    document.getElementById('rangoA').addEventListener('change', function() {
      if (this.value !== 'personalizado') {
        const fechas = calcularFechasPorRango(this.value);
        document.getElementById('fechaInicioA').value = fechas.inicio;
        document.getElementById('fechaFinA').value = fechas.fin;
      }
    });
    
    document.getElementById('rangoB').addEventListener('change', function() {
      if (this.value !== 'personalizado') {
        const fechas = calcularFechasPorRango(this.value);
        document.getElementById('fechaInicioB').value = fechas.inicio;
        document.getElementById('fechaFinB').value = fechas.fin;
      }
    });
  }
  {{else}}
  // Modo normal activo
  const periodoForm = document.getElementById('periodoForm');
  const tipoPeriodo = document.getElementById('tipoPeriodo');
  
  // Botones de per√≠odo r√°pido
  document.querySelectorAll('[data-periodo]').forEach(btn => {
    btn.addEventListener('click', function() {
      const periodo = this.getAttribute('data-periodo');
      
      // Actualizar campo hidden
      tipoPeriodo.value = periodo;
      
      // Activar bot√≥n seleccionado
      document.querySelectorAll('[data-periodo]').forEach(b => {
        b.classList.remove('active');
        b.classList.add('btn-outline-primary');
        b.classList.remove('btn-primary');
      });
      this.classList.add('active', 'btn-primary');
      this.classList.remove('btn-outline-primary');
      
      // Calcular fechas seg√∫n per√≠odo
      const fechas = calcularFechasPeriodo(periodo);
      document.getElementById('fechaInicio').value = fechas.inicio;
      document.getElementById('fechaFin').value = fechas.fin;
      
      // Enviar formulario autom√°ticamente
      periodoForm.submit();
    });
  });
  
  // Cambio autom√°tico en campos de fecha
  document.getElementById('fechaInicio').addEventListener('change', function() {
    tipoPeriodo.value = 'personalizado';
    periodoForm.submit();
  });
  
  document.getElementById('fechaFin').addEventListener('change', function() {
    tipoPeriodo.value = 'personalizado';
    periodoForm.submit();
  });
  
  // Marcar bot√≥n activo seg√∫n per√≠odo actual
  const periodoActual = tipoPeriodo.value;
  const btnActivo = document.querySelector(`[data-periodo="${periodoActual}"]`);
  if (btnActivo) {
    btnActivo.classList.add('active', 'btn-primary');
    btnActivo.classList.remove('btn-outline-primary');
  }
  {{/if}}
  
  // ============ FUNCIONES GLOBALES ============
  
  function calcularFechasPeriodo(periodo) {
    const hoy = new Date();
    let inicio, fin;
    
    switch(periodo) {
      case 'hoy':
        inicio = fin = hoy.toISOString().split('T')[0];
        break;
      case 'semana':
        const inicioSemana = new Date(hoy);
        inicioSemana.setDate(hoy.getDate() - hoy.getDay());
        inicio = inicioSemana.toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      case 'mes':
        inicio = new Date(hoy.getFullYear(), hoy.getMonth(), 1).toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      case 'ultimo_mes':
        const hace30Dias = new Date(hoy);
        hace30Dias.setDate(hoy.getDate() - 30);
        inicio = hace30Dias.toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      case 'desde_inicio':
        // Para "A√±o" - mostrar todos los datos hist√≥ricos
        inicio = '2020-01-01';
        fin = hoy.toISOString().split('T')[0];
        break;
      default:
        inicio = new Date(hoy.getFullYear(), hoy.getMonth(), 1).toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
    }
    
    return { inicio, fin };
  }
  
  // Funci√≥n espec√≠fica para rangos comparativos
  function calcularFechasPorRango(rango) {
    const hoy = new Date();
    let inicio, fin;
    
    switch(rango) {
      case 'hoy':
        inicio = fin = hoy.toISOString().split('T')[0];
        break;
      case 'ayer':
        const ayer = new Date(hoy);
        ayer.setDate(hoy.getDate() - 1);
        inicio = fin = ayer.toISOString().split('T')[0];
        break;
      case 'semana':
        const inicioSemana = new Date(hoy);
        inicioSemana.setDate(hoy.getDate() - hoy.getDay());
        inicio = inicioSemana.toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      case 'semana_anterior':
        const inicioSemanaAnt = new Date(hoy);
        inicioSemanaAnt.setDate(hoy.getDate() - hoy.getDay() - 7);
        const finSemanaAnt = new Date(inicioSemanaAnt);
        finSemanaAnt.setDate(inicioSemanaAnt.getDate() + 6);
        inicio = inicioSemanaAnt.toISOString().split('T')[0];
        fin = finSemanaAnt.toISOString().split('T')[0];
        break;
      case 'mes':
        inicio = new Date(hoy.getFullYear(), hoy.getMonth(), 1).toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      case 'mes_anterior':
        const mesAnt = new Date(hoy.getFullYear(), hoy.getMonth() - 1, 1);
        const finMesAnt = new Date(hoy.getFullYear(), hoy.getMonth(), 0);
        inicio = mesAnt.toISOString().split('T')[0];
        fin = finMesAnt.toISOString().split('T')[0];
        break;
      case 'trimestre':
        const inicioTrimestre = new Date(hoy.getFullYear(), Math.floor(hoy.getMonth() / 3) * 3, 1);
        inicio = inicioTrimestre.toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      case 'trimestre_anterior':
        const trimestreAnt = Math.floor(hoy.getMonth() / 3) - 1;
        const a√±oTrimAnt = trimestreAnt < 0 ? hoy.getFullYear() - 1 : hoy.getFullYear();
        const trimestreAjustado = trimestreAnt < 0 ? 3 : trimestreAnt;
        const inicioTrimAnt = new Date(a√±oTrimAnt, trimestreAjustado * 3, 1);
        const finTrimAnt = new Date(a√±oTrimAnt, trimestreAjustado * 3 + 3, 0);
        inicio = inicioTrimAnt.toISOString().split('T')[0];
        fin = finTrimAnt.toISOString().split('T')[0];
        break;
      case 'a√±o':
        inicio = new Date(hoy.getFullYear(), 0, 1).toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      case 'a√±o_anterior':
        inicio = new Date(hoy.getFullYear() - 1, 0, 1).toISOString().split('T')[0];
        fin = new Date(hoy.getFullYear() - 1, 11, 31).toISOString().split('T')[0];
        break;
      case 'ultimos_30':
        const hace30 = new Date(hoy);
        hace30.setDate(hoy.getDate() - 30);
        inicio = hace30.toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      case '30_dias_anteriores':
        const hace60 = new Date(hoy);
        hace60.setDate(hoy.getDate() - 60);
        const hace30_2 = new Date(hoy);
        hace30_2.setDate(hoy.getDate() - 30);
        inicio = hace60.toISOString().split('T')[0];
        fin = hace30_2.toISOString().split('T')[0];
        break;
      default:
        inicio = new Date(hoy.getFullYear(), hoy.getMonth(), 1).toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
    }
    
    return { inicio, fin };
  }
  
  // ============ SCROLL SUAVE A ALERTAS ============
  
  document.querySelectorAll('a[href="#alertas-section"]').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const alertasSection = document.getElementById('alertas-section');
      if (alertasSection) {
        alertasSection.scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
  
  // ============ ANIMACIONES Y EFECTOS MEJORADOS ============
  
  // Efecto hover en cards de m√©tricas con mejor performance
  const cards = document.querySelectorAll('.card');
  cards.forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-2px)';
      this.style.transition = 'transform 0.2s ease, box-shadow 0.2s ease';
      this.style.boxShadow = '0 0.5rem 1rem rgba(0, 0, 0, 0.15)';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '';
    });
  });
  
  // Loading state visual para cambios de per√≠odo
  periodoForm.addEventListener('submit', function() {
    // Mostrar indicador de carga en el bot√≥n activo
    const btnActivo = document.querySelector('[data-periodo].active');
    if (btnActivo) {
      const originalText = btnActivo.innerHTML;
      btnActivo.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      btnActivo.disabled = true;
    }
  });
  
  // Auto-actualizaci√≥n cada 5 minutos si est√° en "hoy"
  if (tipoPeriodo.value === 'hoy') {
    setInterval(function() {
      // Solo recargar si la p√°gina est√° visible
      if (!document.hidden) {
        location.reload();
      }
    }, 5 * 60 * 1000); // 5 minutos
  }
  
  // ============ VALIDACI√ìN MATEM√ÅTICA VISUAL ============
  
  // Verificar consistencia de datos financieros
  const facturado = parseFloat('{{finanzas.facturacionPeriodo}}') || 0;
  const ingresos = parseFloat('{{finanzas.ingresosPeriodo}}') || 0;
  const pendiente = parseFloat('{{finanzas.totalPendiente}}') || 0;
  
  const diferencia = Math.abs(facturado - (ingresos + pendiente));
  
  if (diferencia > 0.01) {
    console.warn('‚ö†Ô∏è Inconsistencia en datos financieros detectada:');
    console.warn('Facturado:', facturado);
    console.warn('Ingresos + Pendiente:', ingresos + pendiente);
    console.warn('Diferencia:', diferencia);
    
    // Mostrar alerta visual si hay inconsistencia mayor
    if (diferencia > 1) {
      const validacionAlert = document.querySelector('.alert.border-left-info');
      if (validacionAlert) {
        validacionAlert.classList.remove('border-left-info');
        validacionAlert.classList.add('border-left-warning');
        validacionAlert.innerHTML = validacionAlert.innerHTML.replace(
          'Datos del per√≠odo seleccionado',
          '‚ö†Ô∏è Posible inconsistencia en datos - Diferencia: $' + diferencia.toFixed(2)
        );
      }
    }
  }
  
  // ============ OPTIMIZACI√ìN DE PERFORMANCE ============
  
  // Lazy loading para secciones no cr√≠ticas
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate-fade-in');
      }
    });
  });
  
  // Observar tablas y secciones secundarias
  document.querySelectorAll('.table, .list-group').forEach(el => {
    observer.observe(el);
  });
});

// ============ FUNCIONES GLOBALES PARA MODO COMPARATIVO ============

// Cambiar entre modo normal y comparativo
function cambiarModo(modo) {
  if (modo === 'comparativo') {
    window.location.href = '/admin?modo=comparativo&rangoA=mes&rangoB=mes_anterior';
  } else {
    window.location.href = '/admin';
  }
}

// Intercambiar per√≠odos A y B
function intercambiarPeriodos() {
  const rangoA = document.getElementById('rangoA');
  const rangoB = document.getElementById('rangoB');
  const fechaInicioA = document.getElementById('fechaInicioA');
  const fechaFinA = document.getElementById('fechaFinA');
  const fechaInicioB = document.getElementById('fechaInicioB');
  const fechaFinB = document.getElementById('fechaFinB');
  
  if (rangoA && rangoB && fechaInicioA && fechaFinA && fechaInicioB && fechaFinB) {
    // Intercambiar valores
    const tempRango = rangoA.value;
    const tempFechaInicio = fechaInicioA.value;
    const tempFechaFin = fechaFinA.value;
    
    rangoA.value = rangoB.value;
    fechaInicioA.value = fechaInicioB.value;
    fechaFinA.value = fechaFinB.value;
    
    rangoB.value = tempRango;
    fechaInicioB.value = tempFechaInicio;
    fechaFinB.value = tempFechaFin;
    
    // Enviar formulario autom√°ticamente
    document.getElementById('comparativoForm').submit();
  }
}

// ============ CSS ANIMATIONS ============
const style = document.createElement('style');
style.textContent = `
  .animate-fade-in {
    animation: fadeIn 0.5s ease-in-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
`;
document.head.appendChild(style);
</script> 