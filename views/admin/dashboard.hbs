{{!-- üéØ DASHBOARD EJECUTIVO PROFESIONAL - LAYOUT OPTIMIZADO --}}

{{!-- 1. HEADER COMPACTO --}}
<div class="row mb-2">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center bg-white p-3 rounded shadow-sm">
      <div>
        <h4 class="mb-0 text-dark">Panel de Control Ejecutivo</h4>
        <small class="text-muted">{{periodo.periodoTexto}} ‚Ä¢ {{periodo.fechaInicio}} - {{periodo.fechaFin}} ‚Ä¢ {{metricas.totalDocumentos}} docs</small>
      </div>
      <div class="text-end">
        <span class="badge bg-primary px-3 py-2">{{metricas.totalDocumentos}} documentos</span>
      </div>
    </div>
  </div>
</div>

{{!-- 2. FILTROS + ALERTAS EN UNA FILA (COMPACTO) --}}
<div class="row mb-3">
  {{!-- FILTROS COMPACTOS (8 columnas) --}}
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm">
      <div class="card-body py-2">
        <form id="periodoForm" class="row align-items-center">
          <div class="col-md-4">
            <div class="d-flex">
              <input type="date" class="form-control form-control-sm me-1" id="fechaInicio" name="fechaInicio" value="{{periodo.fechaInicio}}">
              <input type="date" class="form-control form-control-sm" id="fechaFin" name="fechaFin" value="{{periodo.fechaFin}}">
            </div>
          </div>
          <div class="col-md-6">
            <div class="btn-group btn-group-sm w-100" role="group">
              <button type="button" class="btn btn-outline-primary" data-periodo="hoy">Hoy</button>
              <button type="button" class="btn btn-outline-primary" data-periodo="semana">7d</button>
              <button type="button" class="btn btn-outline-primary" data-periodo="mes">30d</button>
              <button type="button" class="btn btn-outline-primary" data-periodo="ultimo_mes">A√±o</button>
            </div>
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-primary btn-sm w-100">
              <i class="fas fa-filter"></i> Aplicar
            </button>
          </div>
          <input type="hidden" id="tipoPeriodo" name="tipoPeriodo" value="{{periodo.rango}}">
        </form>
      </div>
    </div>
  </div>
  
  {{!-- ALERTAS COMPACTAS (4 columnas) --}}
  <div class="col-lg-4">
    {{#if alertasCriticas}}
    <div class="card border-0 shadow-sm border-left-warning">
      <div class="card-body py-2">
        <div class="d-flex align-items-center">
          <i class="fas fa-exclamation-triangle text-warning me-2"></i>
          <div class="flex-grow-1">
            <small class="text-warning font-weight-bold">ATENCI√ìN REQUERIDA</small>
            <div class="d-flex justify-content-between">
              <small>{{alertasCriticas.length}} alertas</small>
              <small>{{metricas.documentosUrgentes}} urgentes</small>
            </div>
          </div>
          <a href="#alertas-section" class="btn btn-warning btn-sm">Ver</a>
        </div>
      </div>
    </div>
    {{else}}
    <div class="card border-0 shadow-sm border-left-success">
      <div class="card-body py-2">
        <div class="d-flex align-items-center">
          <i class="fas fa-check-circle text-success me-2"></i>
          <div class="flex-grow-1">
            <small class="text-success font-weight-bold">TODO EN ORDEN</small>
            <div><small class="text-muted">Sin problemas detectados</small></div>
          </div>
        </div>
      </div>
    </div>
    {{/if}}
  </div>
</div>

{{!-- 3. M√âTRICAS PRINCIPALES - VISIBLE SIN SCROLL --}}
<div class="row mb-3">
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card border-0 shadow-sm border-left-primary h-100">
      <div class="card-body py-3">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="fas fa-file-alt fa-2x text-primary"></i>
          </div>
          <div>
            <div class="text-xs font-weight-bold text-primary text-uppercase">Documentos</div>
            <div class="h4 mb-0 font-weight-bold">{{metricas.totalDocumentos}}</div>
            <small class="text-muted">En sistema</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card border-0 shadow-sm border-left-warning h-100">
      <div class="card-body py-3">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="fas fa-cogs fa-2x text-warning"></i>
          </div>
          <div>
            <div class="text-xs font-weight-bold text-warning text-uppercase">En Proceso</div>
            <div class="h4 mb-0 font-weight-bold">{{metricas.enProceso}}</div>
            <small class="text-muted">Procesando</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card border-0 shadow-sm border-left-success h-100">
      <div class="card-body py-3">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="fas fa-check-circle fa-2x text-success"></i>
          </div>
          <div>
            <div class="text-xs font-weight-bold text-success text-uppercase">Listos</div>
            <div class="h4 mb-0 font-weight-bold">{{metricas.listoParaEntrega}}</div>
            <small class="text-muted">Para entrega</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card border-0 shadow-sm border-left-info h-100">
      <div class="card-body py-3">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="fas fa-handshake fa-2x text-info"></i>
          </div>
          <div>
            <div class="text-xs font-weight-bold text-info text-uppercase">Eficiencia</div>
            <div class="h4 mb-0 font-weight-bold">
              {{#if (and metricas.totalDocumentos (gt metricas.totalDocumentos 0))}}
                {{percentage metricas.entregados metricas.totalDocumentos}}
              {{else}}
                0%
              {{/if}}
            </div>
            <small class="text-muted">Entregados</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{{!-- 4. M√âTRICAS FINANCIERAS CORREGIDAS --}}
<div class="row mb-3">
  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-success text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">INGRESOS REALES</div>
            <div class="h4 mb-0">${{finanzas.ingresosPeriodo}}</div>
            <small class="text-white-75">Pagos recibidos</small>
          </div>
          <i class="fas fa-dollar-sign fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-info text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">FACTURADO TOTAL</div>
            <div class="h4 mb-0">${{finanzas.facturacionPeriodo}}</div>
            <small class="text-white-75">En el per√≠odo</small>
          </div>
          <i class="fas fa-file-invoice fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-warning text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">PENDIENTE COBRO</div>
            <div class="h4 mb-0">${{finanzas.totalPendiente}}</div>
            <small class="text-white-75">Por cobrar</small>
          </div>
          <i class="fas fa-clock fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-2">
    <div class="card bg-dark text-white border-0 shadow-sm h-100">
      <div class="card-body py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-white-50 small">INGRESOS HOY</div>
            <div class="h4 mb-0">${{finanzas.ingresosHoy}}</div>
            <small class="text-white-75">{{finanzas.documentosCobradosHoy}} docs</small>
          </div>
          <i class="fas fa-chart-bar fa-2x text-white-25"></i>
        </div>
      </div>
    </div>
  </div>
</div>

{{!-- VALIDACI√ìN MATEM√ÅTICA VISIBLE --}}
<div class="row mb-3">
  <div class="col-12">
    <div class="alert alert-light border-left-info py-2">
      <small class="text-muted">
        <i class="fas fa-calculator me-1"></i>
        <strong>Validaci√≥n:</strong> 
        Facturado (${{finanzas.facturacionPeriodo}}) vs Ingresos (${{finanzas.ingresosPeriodo}}) + Pendiente (${{finanzas.totalPendiente}})
        <span class="text-info ms-2"><i class="fas fa-info-circle"></i> Datos del per√≠odo seleccionado</span>
      </small>
    </div>
  </div>
</div>

{{!-- üö® ALERTAS CR√çTICAS DESTACADAS --}}
{{#if alertasCriticas}}
<div class="row mb-4">
  <div class="col-12">
    <div class="card border-left-danger shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0 text-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Situaciones que Requieren Atenci√≥n Inmediata
        </h6>
      </div>
      <div class="card-body">
        <div class="row">
          {{#each alertasCriticas}}
          <div class="col-md-6 col-xl-3 mb-3">
            <div class="alert alert-{{tipo}} border-left-{{tipo}} mb-0">
              <div class="d-flex align-items-center">
                <i class="{{icono}} fa-2x me-3"></i>
                <div>
                  <div class="font-weight-bold">{{titulo}}</div>
                  <small>{{descripcion}}</small>
                  <div class="mt-2">
                    <a href="{{accion}}" class="btn btn-{{tipo}} btn-sm">
                      <i class="fas fa-arrow-right me-1"></i>Gestionar
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </div>
  </div>
</div>
{{/if}}

{{!-- üîÑ ACTIVIDAD RECIENTE Y RENDIMIENTO DEL EQUIPO --}}
<div class="row mb-4">
  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">
          <i class="fas fa-credit-card text-primary me-2"></i>
          √öltimos Pagos Registrados
        </h6>
      </div>
      <div class="card-body">
        {{#if ultimosPagos}}
        <div class="table-responsive">
          <table class="table table-sm table-hover">
            <thead>
              <tr>
                <th>C√≥digo</th>
                <th>Cliente</th>
                <th>Valor</th>
                <th>M√©todo</th>
                <th>Fecha</th>
              </tr>
            </thead>
            <tbody>
              {{#each ultimosPagos}}
              <tr>
                <td>
                  <code class="text-primary">{{this.codigoBarras}}</code>
                </td>
                <td>
                  <div class="font-weight-bold">{{this.nombreCliente}}</div>
                  {{#if this.numeroFactura}}
                  <small class="text-muted">Fact: {{this.numeroFactura}}</small>
                  {{/if}}
                </td>
                <td>
                  <span class="text-success font-weight-bold">${{this.valorFactura}}</span>
                </td>
                <td>
                  <span class="badge bg-secondary">{{this.metodoPago}}</span>
                </td>
                <td>
                  <small class="text-muted">{{formatDateEcuador this.fechaPago}}</small>
                </td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
        <div class="text-center mt-3">
          <a href="/admin/reportes/financiero" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-chart-line me-1"></i>Ver Reporte Financiero
          </a>
        </div>
        {{else}}
        <div class="text-center text-muted py-4">
          <i class="fas fa-info-circle fa-2x mb-2"></i>
          <p class="mb-0">No hay pagos registrados en el per√≠odo seleccionado</p>
          <small class="text-muted">Los pagos aparecer√°n aqu√≠ cuando se registren</small>
        </div>
        {{/if}}
      </div>
    </div>
  </div>

  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">
          <i class="fas fa-users text-primary me-2"></i>
          Rendimiento del Equipo (7 d√≠as)
        </h6>
      </div>
      <div class="card-body">
        {{#if equipoRendimiento}}
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Matrizador</th>
                <th class="text-center">Procesados</th>
                <th class="text-center">Entregados</th>
                <th class="text-end">Cobrado</th>
              </tr>
            </thead>
            <tbody>
              {{#each equipoRendimiento}}
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="bg-primary text-white rounded-circle me-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; font-size: 12px;">
                      {{substring this.nombre 0 2}}
                    </div>
                    <span class="font-weight-bold">{{this.nombre}}</span>
                  </div>
                </td>
                <td class="text-center">
                  <span class="badge bg-primary">{{this.documentos_procesados}}</span>
                </td>
                <td class="text-center">
                  <span class="badge bg-success">{{this.documentos_entregados}}</span>
                </td>
                <td class="text-end">
                  <span class="font-weight-bold">${{this.dinero_cobrado}}</span>
                </td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
        <div class="text-center mt-3">
          <a href="/admin/reportes/matrizadores" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-users me-1"></i>Ver Reporte Completo
          </a>
        </div>
        {{else}}
        <div class="text-center text-muted py-4">
          <i class="fas fa-users fa-2x mb-2"></i>
          <p class="mb-0">No hay datos de rendimiento disponibles</p>
        </div>
        {{/if}}
      </div>
    </div>
  </div>
</div>

{{!-- üö® SECCI√ìN DE ALERTAS DETALLADAS --}}
{{#if alertasCriticas}}
<div id="alertas-section" class="row mb-4">
  <div class="col-12">
    <div class="card border-left-danger shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0 text-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Situaciones que Requieren Atenci√≥n Inmediata
        </h6>
      </div>
      <div class="card-body">
        <div class="row">
          {{#each alertasCriticas}}
          <div class="col-md-6 col-xl-3 mb-3">
            <div class="alert alert-{{tipo}} border-left-{{tipo}} mb-0">
              <div class="d-flex align-items-center">
                <i class="{{icono}} fa-2x me-3"></i>
                <div>
                  <div class="font-weight-bold">{{titulo}}</div>
                  <small>{{descripcion}}</small>
                  <div class="mt-2">
                    <a href="{{accion}}" class="btn btn-{{tipo}} btn-sm">
                      <i class="fas fa-arrow-right me-1"></i>Gestionar
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </div>
  </div>
</div>
{{/if}}

{{!-- üìã √öLTIMAS ENTREGAS Y DOCUMENTOS CR√çTICOS --}}
<div class="row mb-4">
  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">
          <i class="fas fa-handshake text-primary me-2"></i>
          √öltimas Entregas Realizadas
        </h6>
      </div>
      <div class="card-body">
        {{#if ultimasEntregas}}
        <div class="list-group list-group-flush">
          {{#each ultimasEntregas}}
          <div class="list-group-item border-0 px-0">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <div class="font-weight-bold">{{this.nombreCliente}}</div>
                <small class="text-muted">{{this.codigoBarras}} - {{this.tipoDocumento}}</small>
                {{#if this.matrizador}}
                <div><small class="text-info">Matrizador: {{this.matrizador.nombre}}</small></div>
                {{/if}}
              </div>
              <div class="text-end">
                <span class="badge bg-success">Entregado</span>
                <div><small class="text-muted">{{formatDate this.fechaEntrega}}</small></div>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
        <div class="text-center mt-3">
          <a href="/admin/documentos/listado?estado=entregado" class="btn btn-outline-success btn-sm">
            <i class="fas fa-list me-1"></i>Ver Todos los Entregados
          </a>
        </div>
        {{else}}
        <div class="text-center text-muted py-4">
          <i class="fas fa-handshake fa-2x mb-2"></i>
          <p class="mb-0">No hay entregas recientes</p>
        </div>
        {{/if}}
      </div>
    </div>
  </div>

  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">
          <i class="fas fa-exclamation-triangle text-warning me-2"></i>
          Documentos que Requieren Atenci√≥n
        </h6>
      </div>
      <div class="card-body">
        {{#if documentosUrgentes}}
        <div class="list-group list-group-flush">
          {{#each documentosUrgentes}}
          <div class="list-group-item border-0 px-0">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <div class="font-weight-bold">{{this.codigoBarras}}</div>
                <small class="text-muted">{{this.nombreCliente}}</small>
                {{#if this.matrizador}}
                <div><small class="text-info">Asignado: {{this.matrizador.nombre}}</small></div>
                {{/if}}
              </div>
              <div class="text-end">
                <span class="badge bg-warning">Pendiente</span>
                <div><small class="text-muted">{{daysAgo this.createdAt}} d√≠as</small></div>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
        <div class="text-center mt-3">
          <a href="/admin/reportes/pendientes" class="btn btn-outline-warning btn-sm">
            <i class="fas fa-exclamation-triangle me-1"></i>Ver Reporte de Pendientes
          </a>
        </div>
        {{else}}
        <div class="text-center text-muted py-4">
          <i class="fas fa-check-circle fa-2x mb-2 text-success"></i>
          <p class="mb-0">Todos los documentos est√°n al d√≠a</p>
        </div>
        {{/if}}
      </div>
    </div>
  </div>
</div>

{{!-- üéØ ACCESOS R√ÅPIDOS EJECUTIVOS --}}
<div class="row mb-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">
          <i class="fas fa-bolt text-primary me-2"></i>
          Accesos R√°pidos Administrativos
        </h6>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col-md-3 mb-3">
            <a href="/admin/reportes/pendientes" class="btn btn-lg btn-outline-danger w-100 h-100 py-4">
              <i class="fas fa-exclamation-triangle fa-2x mb-3"></i><br>
              <strong>Pagos Atrasados</strong><br>
              <small>Gesti√≥n de cobranza</small>
            </a>
          </div>
          <div class="col-md-3 mb-3">
            <a href="/admin/reportes/financiero" class="btn btn-lg btn-outline-success w-100 h-100 py-4">
              <i class="fas fa-chart-line fa-2x mb-3"></i><br>
              <strong>Reporte Financiero</strong><br>
              <small>An√°lisis de ingresos</small>
            </a>
          </div>
          <div class="col-md-3 mb-3">
            <a href="/admin/documentos/listado" class="btn btn-lg btn-outline-primary w-100 h-100 py-4">
              <i class="fas fa-search fa-2x mb-3"></i><br>
              <strong>Buscar Documentos</strong><br>
              <small>Consulta avanzada</small>
            </a>
          </div>
          <div class="col-md-3 mb-3">
            <a href="/admin/auditoria-eliminaciones" class="btn btn-lg btn-outline-info w-100 h-100 py-4">
              <i class="fas fa-shield-alt fa-2x mb-3"></i><br>
              <strong>Auditor√≠a</strong><br>
              <small>Registros de seguridad</small>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{{!-- üîß JAVASCRIPT PARA FUNCIONALIDAD INTERACTIVA OPTIMIZADA --}}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // ============ FUNCIONALIDAD DE FILTROS OPTIMIZADA ============
  
  const periodoForm = document.getElementById('periodoForm');
  const tipoPeriodo = document.getElementById('tipoPeriodo');
  
  // Botones de per√≠odo r√°pido
  document.querySelectorAll('[data-periodo]').forEach(btn => {
    btn.addEventListener('click', function() {
      const periodo = this.getAttribute('data-periodo');
      
      // Actualizar campo hidden
      tipoPeriodo.value = periodo;
      
      // Activar bot√≥n seleccionado
      document.querySelectorAll('[data-periodo]').forEach(b => {
        b.classList.remove('active');
        b.classList.add('btn-outline-primary');
        b.classList.remove('btn-primary');
      });
      this.classList.add('active', 'btn-primary');
      this.classList.remove('btn-outline-primary');
      
      // Calcular fechas seg√∫n per√≠odo
      const fechas = calcularFechasPeriodo(periodo);
      document.getElementById('fechaInicio').value = fechas.inicio;
      document.getElementById('fechaFin').value = fechas.fin;
      
      // Enviar formulario autom√°ticamente
      periodoForm.submit();
    });
  });
  
  // Marcar bot√≥n activo seg√∫n per√≠odo actual
  const periodoActual = tipoPeriodo.value;
  const btnActivo = document.querySelector(`[data-periodo="${periodoActual}"]`);
  if (btnActivo) {
    btnActivo.classList.add('active', 'btn-primary');
    btnActivo.classList.remove('btn-outline-primary');
  }
  
  // ============ FUNCIONES AUXILIARES ============
  
  function calcularFechasPeriodo(periodo) {
    const hoy = new Date();
    let inicio, fin;
    
    switch(periodo) {
      case 'hoy':
        inicio = fin = hoy.toISOString().split('T')[0];
        break;
      case 'semana':
        const inicioSemana = new Date(hoy);
        inicioSemana.setDate(hoy.getDate() - hoy.getDay());
        inicio = inicioSemana.toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      case 'mes':
        inicio = new Date(hoy.getFullYear(), hoy.getMonth(), 1).toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      case 'ultimo_mes':
        const hace30Dias = new Date(hoy);
        hace30Dias.setDate(hoy.getDate() - 30);
        inicio = hace30Dias.toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
        break;
      default:
        inicio = new Date(hoy.getFullYear(), hoy.getMonth(), 1).toISOString().split('T')[0];
        fin = hoy.toISOString().split('T')[0];
    }
    
    return { inicio, fin };
  }
  
  // ============ SCROLL SUAVE A ALERTAS ============
  
  document.querySelectorAll('a[href="#alertas-section"]').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const alertasSection = document.getElementById('alertas-section');
      if (alertasSection) {
        alertasSection.scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
  
  // ============ ANIMACIONES Y EFECTOS MEJORADOS ============
  
  // Efecto hover en cards de m√©tricas con mejor performance
  const cards = document.querySelectorAll('.card');
  cards.forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-2px)';
      this.style.transition = 'transform 0.2s ease, box-shadow 0.2s ease';
      this.style.boxShadow = '0 0.5rem 1rem rgba(0, 0, 0, 0.15)';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '';
    });
  });
  
  // Loading state mejorado para formularios
  periodoForm.addEventListener('submit', function() {
    const submitBtn = this.querySelector('button[type="submit"]');
    if (submitBtn) {
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando...';
      submitBtn.disabled = true;
      
      // Restaurar despu√©s de 3 segundos si no se recarga la p√°gina
      setTimeout(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }, 3000);
    }
  });
  
  // Auto-actualizaci√≥n cada 5 minutos si est√° en "hoy"
  if (tipoPeriodo.value === 'hoy') {
    setInterval(function() {
      // Solo recargar si la p√°gina est√° visible
      if (!document.hidden) {
        location.reload();
      }
    }, 5 * 60 * 1000); // 5 minutos
  }
  
  // ============ VALIDACI√ìN MATEM√ÅTICA VISUAL ============
  
  // Verificar consistencia de datos financieros
  const facturado = parseFloat('{{finanzas.facturacionPeriodo}}') || 0;
  const ingresos = parseFloat('{{finanzas.ingresosPeriodo}}') || 0;
  const pendiente = parseFloat('{{finanzas.totalPendiente}}') || 0;
  
  const diferencia = Math.abs(facturado - (ingresos + pendiente));
  
  if (diferencia > 0.01) {
    console.warn('‚ö†Ô∏è Inconsistencia en datos financieros detectada:');
    console.warn('Facturado:', facturado);
    console.warn('Ingresos + Pendiente:', ingresos + pendiente);
    console.warn('Diferencia:', diferencia);
    
    // Mostrar alerta visual si hay inconsistencia mayor
    if (diferencia > 1) {
      const validacionAlert = document.querySelector('.alert.border-left-info');
      if (validacionAlert) {
        validacionAlert.classList.remove('border-left-info');
        validacionAlert.classList.add('border-left-warning');
        validacionAlert.innerHTML = validacionAlert.innerHTML.replace(
          'Datos del per√≠odo seleccionado',
          '‚ö†Ô∏è Posible inconsistencia en datos - Diferencia: $' + diferencia.toFixed(2)
        );
      }
    }
  }
  
  // ============ OPTIMIZACI√ìN DE PERFORMANCE ============
  
  // Lazy loading para secciones no cr√≠ticas
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate-fade-in');
      }
    });
  });
  
  // Observar tablas y secciones secundarias
  document.querySelectorAll('.table, .list-group').forEach(el => {
    observer.observe(el);
  });
});

// ============ CSS ANIMATIONS ============
const style = document.createElement('style');
style.textContent = `
  .animate-fade-in {
    animation: fadeIn 0.5s ease-in-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
`;
document.head.appendChild(style);
</script> 