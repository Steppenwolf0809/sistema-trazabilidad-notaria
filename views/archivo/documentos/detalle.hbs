{{! Detalle de Documento - Archivo }}
{{#if documento}}
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <div>
      <i class="fas fa-file-alt me-2"></i> Detalle de Documento
    </div>
    <div>
      <a href="/archivo/documentos/mis-documentos" class="btn btn-sm btn-outline-secondary">
        <i class="fas fa-arrow-left me-1"></i> Volver
      </a>
      
      {{#if esDocumentoPropio}}
        <a href="/archivo/documentos/editar/{{documento.id}}" class="btn btn-sm btn-primary ms-1">
          <i class="fas fa-edit me-1"></i> Editar
        </a>
        
        {{#if (eq documento.estado "en_proceso")}}
        <button type="button" class="btn btn-sm btn-success ms-1" onclick="marcarListo({{documento.id}})">
          <i class="fas fa-check me-1"></i> Marcar como listo
        </button>
        {{/if}}
        
        {{#if (eq documento.estado "listo_para_entrega")}}
        <a href="/archivo/documentos/entrega/{{documento.id}}" class="btn btn-sm btn-info ms-1">
          <i class="fas fa-hand-holding me-1"></i> Entrega
        </a>
        {{/if}}
      {{else}}
        <span class="badge bg-warning">Solo Lectura</span>
      {{/if}}
    </div>
  </div>
  <div class="card-body">
    <!-- Informaci√≥n general -->
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="mb-3">
          <h5 class="border-bottom pb-2">Informaci√≥n General</h5>
          <p><strong>N√∫mero Documento:</strong> <span class="badge bg-primary fs-6">{{documento.codigoBarras}}</span></p>
          <p><strong>Tipo:</strong> {{documento.tipoDocumento}}</p>
          <p><strong>Estado:</strong> 
            {{#if (eq documento.estado "en_proceso")}}
            <span class="badge bg-warning">En Proceso</span>
            {{else if (eq documento.estado "listo_para_entrega")}}
            <span class="badge bg-success">Listo para Entrega</span>
            {{else if (eq documento.estado "entregado")}}
            <span class="badge bg-primary">Entregado</span>
            {{else if (eq documento.estado "cancelado")}}
            <span class="badge bg-danger">Cancelado</span>
            {{else}}
            <span class="badge bg-secondary">{{documento.estado}}</span>
            {{/if}}
          </p>
          <p><strong>üìÖ Fecha Documento:</strong> {{formatDate documento.fechaFactura}}</p>
          {{#if documento.fechaEntrega}}
          <p><strong>üöÄ Fecha Entrega:</strong> {{formatDate documento.fechaEntrega}}</p>
          {{/if}}
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="mb-3">
          <h5 class="border-bottom pb-2">Cliente</h5>
          <p><strong>Nombre:</strong> {{documento.nombreCliente}}</p>
          <p><strong>Identificaci√≥n:</strong> {{documento.identificacionCliente}}</p>
          {{#if documento.emailCliente}}
          <p><strong>Email:</strong> {{documento.emailCliente}}</p>
          {{/if}}
          {{#if documento.telefonoCliente}}
          <p><strong>Tel√©fono:</strong> {{documento.telefonoCliente}}</p>
          {{/if}}
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="mb-3">
          <h5 class="border-bottom pb-2">Responsable</h5>
          <p><strong>Matrizador:</strong> {{documento.matrizador.nombre}}</p>
          {{#if esDocumentoPropio}}
            <p><strong>Mi Documento:</strong> <span class="badge bg-success">‚úÖ Asignado a m√≠</span></p>
            {{#if (eq documento.estado "listo_para_entrega")}}
            <p><strong>üîë C√≥digo de Entrega:</strong> 
              <span class="badge bg-success fs-5">{{documento.codigoVerificacion}}</span>
            </p>
            {{/if}}
          {{else}}
            <p><strong>Acceso:</strong> <span class="badge bg-warning">Solo Lectura</span></p>
          {{/if}}
        </div>
      </div>
    </div>
    
    <!-- Informaci√≥n financiera -->
    {{#if documento.valorFactura}}
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-money-bill-wave me-2"></i>Informaci√≥n Financiera</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <p><strong>üí∞ Valor Total:</strong> <span class="fs-5 text-primary">${{formatMoney documento.valorFactura}}</span></p>
                <p><strong>üè∑Ô∏è Estado Pago:</strong> 
                  {{#if (eq documento.estadoPago "pagado_completo")}}
                  <span class="badge bg-success">Pagado Completo</span>
                  {{else if (eq documento.estadoPago "pagado_con_retencion")}}
                  <span class="badge bg-info">Con Retenci√≥n</span>
                  {{else if (eq documento.estadoPago "pago_parcial")}}
                  <span class="badge bg-warning">Pago Parcial</span>
                  {{else}}
                  <span class="badge bg-danger">Pendiente</span>
                  {{/if}}
                </p>
              </div>
              <div class="col-md-6">
                {{#if documento.metodoPago}}
                <p><strong>üí≥ M√©todo de Pago:</strong> {{documento.metodoPago}}</p>
                {{/if}}
                {{#if documento.fechaPago}}
                <p><strong>üìÖ Fecha de Pago:</strong> {{formatDateTime documento.fechaPago}}</p>
                {{/if}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {{/if}}
    
    <!-- Notas -->
    {{#if documento.notas}}
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-sticky-note me-2"></i>Notas</h5>
          </div>
          <div class="card-body">
            <p>{{documento.notas}}</p>
          </div>
        </div>
      </div>
    </div>
    {{/if}}
    
    <!-- üÜï HISTORIAL UNIVERSAL -->
    {{> historial-universal eventos=eventos}}
  </div>
</div>
{{else}}
<div class="alert alert-danger">
  <h4>Documento no encontrado</h4>
  <p>El documento solicitado no existe o no tienes permisos para verlo.</p>
  <a href="/archivo/documentos/mis-documentos" class="btn btn-primary">Volver a mis documentos</a>
</div>
{{/if}}

<!-- CSS eliminado - Ahora usa el sistema universal -->

<script>
function marcarListo(documentoId) {
  if (confirm('¬øEst√° seguro de marcar este documento como listo para entrega?')) {
    fetch(`/archivo/documentos/marcar-listo/${documentoId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.exito) {
        alert('Documento marcado como listo exitosamente');
        location.reload();
      } else {
        alert('Error: ' + data.mensaje);
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error al marcar documento como listo');
    });
  }
}
</script> 