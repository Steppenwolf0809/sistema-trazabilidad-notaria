{{!-- 
  COMPONENTE UNIVERSAL DE HISTORIAL DE DOCUMENTOS
  âœ… DiseÃ±o consistente entre admin, caja, matrizador, archivo
  âœ… CronologÃ­a visual con lÃ­nea de tiempo
  âœ… InformaciÃ³n especÃ­fica para cada tipo de evento
--}}

{{#if eventos.length}}
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">
      <i class="fas fa-history me-2"></i>Historial del Documento
    </h5>
    <div class="d-flex align-items-center">
      <span class="badge bg-primary me-2">{{eventos.length}} eventos</span>
      <small class="text-muted">CronologÃ­a completa</small>
    </div>
  </div>
  <div class="card-body">
    <div class="timeline-universal">
      {{#each eventos}}
      <div class="timeline-evento mb-4 {{#if @first}}timeline-evento-primero{{/if}}">
        
        <!-- Marcador Visual -->
        <div class="timeline-marcador bg-{{this.color}}">
          <div class="timeline-icono">
            {{{this.icono}}}
          </div>
          {{#unless @last}}
          <div class="timeline-linea"></div>
          {{/unless}}
        </div>
        
        <!-- Contenido del Evento -->
        <div class="timeline-contenido">
          <div class="evento-card border rounded p-3 bg-light">
            
            <!-- Cabecera del Evento -->
            <div class="evento-header d-flex justify-content-between align-items-start mb-2">
              <div class="evento-titulo-area">
                <h6 class="evento-titulo mb-1 text-{{this.color}} fw-bold">
                  {{{this.icono}}} {{this.titulo}}
                </h6>
                <div class="evento-categoria">
                  <span class="badge badge-outline-{{this.color}}">{{this.categoriaTexto}}</span>
                  {{#if this.prioridad}}
                  <span class="badge bg-{{this.prioridad}} ms-1">{{this.prioridadTexto}}</span>
                  {{/if}}
                </div>
              </div>
              
              <!-- InformaciÃ³n de Tiempo -->
              <div class="evento-tiempo text-end">
                <div class="fecha-evento text-primary fw-semibold">
                  ðŸ“… {{formatDateTime this.fecha}}
                </div>
                {{#if this.tiempoTranscurrido}}
                <small class="text-muted">{{this.tiempoTranscurrido}}</small>
                {{/if}}
              </div>
            </div>
            
            <!-- DescripciÃ³n Principal -->
            <div class="evento-descripcion mb-3">
              <p class="mb-0">{{this.descripcion}}</p>
            </div>
            
            <!-- InformaciÃ³n del Usuario -->
            <div class="evento-usuario mb-2">
              <span class="text-muted">
                ðŸ‘¤ <strong>{{this.usuario}}</strong>
                {{#if this.rolUsuario}}
                <span class="badge bg-secondary ms-1">{{this.rolUsuario}}</span>
                {{/if}}
              </span>
            </div>
            
            <!-- Detalles EspecÃ­ficos del Evento -->
            {{#if this.detalles}}
            <div class="evento-detalles">
              
              {{!-- PAGO: InformaciÃ³n financiera --}}
              {{#if (eq this.tipoEvento "pago_registrado")}}
              <div class="row g-2">
                {{#if this.detalles.monto}}
                <div class="col-auto">
                  <span class="badge bg-success">ðŸ’° ${{this.detalles.monto}}</span>
                </div>
                {{/if}}
                {{#if this.detalles.metodoPago}}
                <div class="col-auto">
                  <span class="badge bg-info">ðŸ’³ {{this.detalles.metodoPago}}</span>
                </div>
                {{/if}}
                {{#if this.detalles.numeroFactura}}
                <div class="col-auto">
                  <span class="badge bg-secondary">ðŸ“„ {{this.detalles.numeroFactura}}</span>
                </div>
                {{/if}}
              </div>
              {{/if}}
              
              {{!-- ENTREGA: InformaciÃ³n del receptor --}}
              {{#if (eq this.tipoEvento "documento_entregado")}}
              <div class="row g-2">
                {{#if this.detalles.receptor}}
                <div class="col-auto">
                  <span class="badge bg-primary">ðŸ‘¤ {{this.detalles.receptor}}</span>
                </div>
                {{/if}}
                {{#if this.detalles.identificacionReceptor}}
                <div class="col-auto">
                  <span class="badge bg-secondary">ðŸ†” {{this.detalles.identificacionReceptor}}</span>
                </div>
                {{/if}}
                {{#if this.detalles.relacion}}
                <div class="col-auto">
                  <span class="badge bg-info">ðŸ”— {{this.detalles.relacion}}</span>
                </div>
                {{/if}}
              </div>
              {{/if}}
              
              {{!-- CREACIÃ“N: InformaciÃ³n del documento --}}
              {{#if (eq this.tipoEvento "documento_creado")}}
              <div class="row g-2">
                {{#if this.detalles.tipoDocumento}}
                <div class="col-auto">
                  <span class="badge bg-primary">ðŸ“‹ {{this.detalles.tipoDocumento}}</span>
                </div>
                {{/if}}
                {{#if this.detalles.valorFactura}}
                <div class="col-auto">
                  <span class="badge bg-success">ðŸ’° ${{this.detalles.valorFactura}}</span>
                </div>
                {{/if}}
                {{#if this.detalles.origen}}
                <div class="col-auto">
                  <span class="badge bg-info">ðŸ“¥ {{this.detalles.origen}}</span>
                </div>
                {{/if}}
              </div>
              {{/if}}
              
              {{!-- NOTIFICACIÃ“N: InformaciÃ³n del envÃ­o --}}
              {{#if (eq this.tipoEvento "notificacion_enviada")}}
              <div class="row g-2">
                {{#if this.detalles.canal}}
                <div class="col-auto">
                  <span class="badge bg-primary">ðŸ“± {{this.detalles.canal}}</span>
                </div>
                {{/if}}
                {{#if this.detalles.destinatario}}
                <div class="col-auto">
                  <span class="badge bg-info">ðŸ“§ {{this.detalles.destinatario}}</span>
                </div>
                {{/if}}
              </div>
              {{/if}}
              
              {{!-- INFORMACIÃ“N ADICIONAL: Observaciones --}}
              {{#if this.detalles.observaciones}}
              <div class="mt-2">
                <div class="alert alert-info py-2 mb-0">
                  <small><strong>Observaciones:</strong> {{this.detalles.observaciones}}</small>
                </div>
              </div>
              {{/if}}
              
            </div>
            {{/if}}
            
          </div>
        </div>
        
      </div>
      {{/each}}
    </div>
    
    {{#if (gt eventos.length 10)}}
    <div class="text-center mt-4">
      <small class="text-muted">
        ðŸ“‹ Mostrando {{eventos.length}} eventos
      </small>
    </div>
    {{/if}}
    
  </div>
</div>

<!-- CSS especÃ­fico para el historial universal -->
<style>
.timeline-universal {
  position: relative;
}

.timeline-evento {
  display: flex;
  position: relative;
}

.timeline-marcador {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  flex-shrink: 0;
  border: 3px solid #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  z-index: 2;
}

.timeline-icono {
  font-size: 1.2rem;
  color: white;
}

.timeline-contenido {
  flex-grow: 1;
  min-width: 0;
}

.evento-card {
  transition: all 0.3s ease;
  border-left: 4px solid transparent !important;
}

.evento-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.timeline-evento-primero .evento-card {
  border-left-color: var(--bs-primary) !important;
}

.evento-titulo {
  font-size: 1.1rem;
  line-height: 1.3;
}

@media (max-width: 768px) {
  .timeline-marcador {
    width: 40px;
    height: 40px;
    margin-right: 0.75rem;
  }
  
  .timeline-icono {
    font-size: 1rem;
  }
  
  .evento-card {
    padding: 0.75rem !important;
  }
}
</style>

{{else}}
<!-- Mensaje cuando no hay eventos -->
<div class="card">
  <div class="card-header">
    <h5 class="mb-0">
      <i class="fas fa-history me-2"></i>Historial del Documento
    </h5>
  </div>
  <div class="card-body text-center py-5">
    <div class="text-muted">
      <i class="fas fa-clock fa-3x mb-3"></i>
      <h6>No hay eventos registrados</h6>
      <p class="mb-0">Este documento aÃºn no tiene historial de eventos.</p>
    </div>
  </div>
</div>
{{/if}}

