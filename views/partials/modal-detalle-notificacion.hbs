<!-- Modal de Detalle de Notificación Elegante -->
<div class="modal-header bg-primary text-white">
    <h5 class="modal-title">
        <i class="fas fa-bell me-2"></i>
        Detalle de Notificación #{{notificacion.id}}
    </h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
</div>

<div class="modal-body p-4">
    <!-- INFORMACIÓN PRINCIPAL -->
    <div class="row mb-4">
        {{#if notificacion.documento}}
        <div class="col-md-6">
            <div class="card border-primary h-100">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="{{iconoTipoDocumento notificacion.documento.tipo}} me-2"></i>
                        Documento
                    </h6>
                </div>
                <div class="card-body">
                    <p class="mb-2">
                        <strong>Código:</strong> 
                        <code class="px-2 py-1 rounded" style="background-color: #6c757d !important; color: white !important; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-weight: 600;">{{notificacion.documento.codigo}}</code>
                    </p>
                    <p class="mb-2">
                        <strong>Tipo:</strong> 
                        <span class="badge bg-primary" style="background-color: #007bff !important; color: white !important;">{{notificacion.documento.tipo}}</span>
                    </p>
                    {{#if notificacion.documento.numeroFactura}}
                    <p class="mb-2">
                        <strong>N° Factura:</strong> 
                        <span class="text-primary">{{notificacion.documento.numeroFactura}}</span>
                    </p>
                    {{/if}}
                    <p class="mb-0">
                        <strong>Estado:</strong> 
                        <span class="badge bg-success" style="background-color: #198754 !important; color: white !important;">{{notificacion.documento.estado}}</span>
                    </p>
                </div>
            </div>
        </div>
        {{/if}}
        
        <div class="col-md-6">
            <div class="card border-info h-100">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="fas fa-user me-2"></i>
                        Cliente
                    </h6>
                </div>
                <div class="card-body">
                    {{#if notificacion.documento.cliente}}
                    <p class="mb-2">
                        <strong>Nombre:</strong><br>
                        <span class="text-dark">{{notificacion.documento.cliente.nombre}}</span>
                    </p>
                    <p class="mb-2">
                        <strong>Identificación:</strong><br>
                        <span class="text-muted">{{notificacion.documento.cliente.identificacion}}</span>
                    </p>
                    {{/if}}
                    <p class="mb-0">
                        <strong>Teléfono:</strong><br>
                        <span class="text-success">
                            <i class="fab fa-whatsapp me-1"></i>
                            {{destinatarioCensurado notificacion.destinatario}}
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- INFORMACIÓN DE NOTIFICACIÓN -->
    <div class="card border-success mb-4">
        <div class="card-header bg-light">
            <h6 class="mb-0">
                <i class="fab fa-whatsapp me-2 text-success"></i>
                Notificación WhatsApp
            </h6>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-4">
                    <p class="mb-1"><strong>Enviado:</strong></p>
                    <p class="text-muted small">
                        <i class="fas fa-calendar me-1"></i>
                        {{formatDate notificacion.fechaEnvio}}<br>
                        <i class="fas fa-clock me-1"></i>
                        {{formatTime notificacion.fechaEnvio}}
                    </p>
                </div>
                <div class="col-md-4">
                    <p class="mb-1"><strong>Código de Verificación:</strong></p>
                    <p>
                        <span class="badge bg-secondary fs-6" style="background-color: #6c757d !important; color: white !important; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-weight: 600;">
                            {{obtenerCodigoVerificacion notificacion}}
                        </span>
                    </p>
                </div>
                <div class="col-md-4">
                    <p class="mb-1"><strong>Intentos de Envío:</strong></p>
                    <p class="text-muted">
                        <i class="fas fa-redo me-1"></i>
                        {{notificacion.intentos}} vez(es)
                    </p>
                </div>
            </div>
            
            <!-- MENSAJE ENVIADO -->
            {{#if notificacion.mensajeEnviado}}
            <div class="mt-3">
                <p class="mb-2"><strong>Mensaje enviado:</strong></p>
                <div class="bg-light p-3 rounded border-start border-success border-3">
                    <pre class="mb-0 text-dark small" style="white-space: pre-wrap; font-family: inherit;">{{notificacion.mensajeEnviado}}</pre>
                </div>
            </div>
            {{/if}}
            
            <!-- ERROR SI EXISTE -->
            {{#if notificacion.ultimoError}}
            <div class="mt-3">
                <p class="mb-2"><strong>Último error:</strong></p>
                <div class="alert alert-danger py-2">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <small>{{notificacion.ultimoError}}</small>
                </div>
            </div>
            {{/if}}
        </div>
    </div>

    <!-- INFORMACIÓN DEL RESPONSABLE -->
    {{#if notificacion.documento.matrizador}}
    <div class="card border-warning">
        <div class="card-header bg-light">
            <h6 class="mb-0">
                <i class="fas fa-user-tie me-2"></i>
                Responsable
            </h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-2">
                        <strong>Matrizador:</strong><br>
                        <span class="text-dark">{{notificacion.documento.matrizador.nombre}}</span>
                    </p>
                    <p class="mb-0">
                        <strong>Email:</strong><br>
                        <a href="mailto:{{notificacion.documento.matrizador.email}}" class="text-decoration-none">
                            <i class="fas fa-envelope me-1"></i>
                            {{notificacion.documento.matrizador.email}}
                        </a>
                    </p>
                </div>
                <div class="col-md-6">
                    {{#if notificacion.documento.fechaListo}}
                    <p class="mb-0">
                        <strong>Marcado listo:</strong><br>
                        <span class="text-muted">{{formatDate notificacion.documento.fechaListo}}</span>
                    </p>
                    {{/if}}
                </div>
            </div>
        </div>
    </div>
    {{/if}}

    <!-- INFORMACIÓN TÉCNICA (Colapsable) -->
    {{#if notificacion.respuestaApi}}
    <div class="mt-4">
        <div class="card border-secondary">
            <div class="card-header bg-light">
                <h6 class="mb-0">
                    <button class="btn btn-link p-0 text-decoration-none" type="button" data-bs-toggle="collapse" data-bs-target="#infoTecnica" aria-expanded="false">
                        <i class="fas fa-code me-2"></i>
                        Información Técnica
                        <i class="fas fa-chevron-down ms-2"></i>
                    </button>
                </h6>
            </div>
            <div id="infoTecnica" class="collapse">
                <div class="card-body">
                    <pre class="mb-0 text-muted small" style="max-height: 200px; overflow-y: auto;">{{json notificacion.respuestaApi}}</pre>
                </div>
            </div>
        </div>
    </div>
    {{/if}}
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
        <i class="fas fa-times me-1"></i>Cerrar
    </button>
    
    {{#if notificacion.puedeReenviar}}
    <button type="button" class="btn btn-success" onclick="reenviarNotificacion({{notificacion.id}})">
        <i class="fab fa-whatsapp me-1"></i>Reenviar
    </button>
    {{/if}}
    
    {{#if notificacion.documento}}
    <a href="/{{@root.userRole}}/documentos/detalle/{{notificacion.documento.id}}" class="btn btn-primary" target="_blank">
        <i class="fas fa-external-link-alt me-1"></i>Ver Documento
    </a>
    {{/if}}
</div> 